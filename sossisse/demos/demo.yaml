###############################################################################
##  Definition of inputs related to the data location and file naming
###############################################################################
#
# Folder structure :
#  /sossiopath/mode/object/rawdata/files    -> that's where your input data
#                                              should be
#  /sossiopath/mode/calibrations/*.fits     -> that's where you put calibration
#                                              files relevant for the mode
#  /sossiopath/mode/object/temporary_*unique_id*/  -> that's where your
#                                                     temporary *FITS* files
#                                                     will be saved
#  /sossiopath/mode/object/plots_*unique_id* / -> plots for that run
#  /sossiopath/mode/object/csv_*unique_id* /-> csv files for that run
#
# *unique_id* will be a long random string constructed from the checksum of
#    the config file
#

# The data directory (required)
SOSSIOPATH: /data/jwst/sossisse/data/demo/
# Set the SOSSISSE ID (SID) for using the same directory as before
#    if left as None the code will work out whether this yaml is found before
#    or a new one
SID: None
# Log level (DEBUG, INFO, WARNING, ERROR, NONE)
LOG_LEVEL: "INFO"
# Name of the object (must match the object directory name)
OBJECTNAME: "t1b"
# Instrument mode i.e. JWST.NIRISS.SOSS or JWST.NIRISS.PRISM
INSTRUMENTMODE: "JWST.NIRISS.SOSS"
# A suffix to identify this setup (e.g. a specific visit)
SUFFIX: "_demo_data_set"

# list of files to be processed
# in form:
# files:
# - file1
# - file2
# - file3
FILES:
  - jw02589001001_04101_00001-seg001_nis_rateints.fits
  - jw02589001001_04101_00001-seg002_nis_rateints.fits

# CALIBRATION FILES -- these should be in the
#     /general_path/mode/calibrations folder
#
# background file --> leave as None if the is no background available for
#    the mode
BKGFILE: "model_background256.fits"

# flat field file --> leave as '' if there is no flat field available
#     for the mode
FLATFILE: "jwst_niriss_flat_0275.fits"

# trace position file
POS_FILE: "SOSS_ref_trace_table_SUBSTRIP256.fits"

# wavelength calibration file
WAVE_FILE: None

# allow for temporary files to speed the process if you run the code more
#    than once
ALLOW_TEMPORARY: true

# Use temporary files (False we overwrite the files for a fresh start even
#   if they exist on disk)
USE_TEMPORARY: true

# Save results at the end
SAVE_RESULTS: true


###############################################################################
##  Plot behavior
###############################################################################

# if you want to see the plots at the end of the code, add your login here
# this should be the string as returned by "os.getlogin()"
USER_SHOW_PLOTS:
- "dummy"

# Or you can use the following to always show plots regardless of the username
SHOW_PLOTS: false

# output(s) type of figure
FIGURE_TYPES:
- png
- pdf

# Define the spectrum plot y limits in parts per million (ppm)
#  Formally spectrum_ylim_ppm
PLOT_SPECTRUIM_YLIM:
- 6000
- 12000

###############################################################################
## Inputs related to the position within data cube timeseries
###############################################################################
# DQ flags that we should use (list)
VALID_DQ:
- 0
- 2

# define the Nth frame for 1st contact [it1],
#      2nd contact [it2] ... through 4th contact
CONTACT_FRAMES:
- 90
- 97
- 103
- 110

# used to reject bits of domain from the analysis
# you can reject frames 0-600 with the values:
#
# REJECT_DOMAIN:
# - [0, 600]
#
# if you want to reject two bits of domain, 0-600 and 3000-3200
# just use
# REJECT_DOMAIN:
# - [0, 600]
# - [3000, 3200]

# If PRISM data or saturated, you can perform a CDS between these two readouts
#cds_id:
#- 2
#- 0

###############################################################################
## What do we fit in the linear model
###############################################################################

# fit the dx -- along the dispersion
FIT_DX: true

# fit the dy -- along the cross-dispersion
FIT_DY: true

# fit the before - after morphological change
FIT_BEFORE_AFTER: false

# fit the rotation in the linear reconstruction of the trace
FIT_ROTATION: true

# fit the zero point offset in the linear model for the trace
FIT_ZERO_POINT_OFFSET: true

# fit a flux^2 dependency. This is mostly meant as a test of the quality
# of the non-linearity correction. Normally this term should be de-correlated
# with the amplitude term. Set to false for actual science analysis
# should not be used at the same time as the zero point offset
FIT_QUAD_TERM: false

# fit the 2nd derivative in y, good to find glitches!
FIT_DDY: true

# fit with a PCA
FIT_PCA: false

# Number of PCA components to use
FIT_N_PCA: 0

# Bin the input data cube in time
DATA_BIN_TIME: false

# Number of frames in each bin
DATA_BIN_SIZE: 1

###############################################################################
## Inputs related to handling of the data within each frame
###############################################################################
# Define whether to use pixel level de-trending
PIXEL_LEVEL_DETRENDING: false

# Define which orders to use
TRACE_ORDERS:
- 1
- 2

# wavelength domain for the white light curve
#WLC_DOMAIN:
#- 1.2
#- 1.6

# median of out-of-transit values for reference trace construction.
# If set to false, then we have the median of the entire timeseries
MEDIAN_OOT: true

# The number of pixels in the x direction to offset the trace by
X_TRACE_OFFSET: 0

# The number of pixels in the y direction to offset the trace by
Y_TRACE_OFFSET: 0

# Whether to mask order zero
MASK_ORDER_ZERO: true

# Whether to recenter the trace position
RECENTER_TRACE_POSITION: true

# out of transit polynomial level correction
TRANSIT_BASELINE_POLYORD: 2

# out-of-trace baseline polynomial order
TRACE_BASELINE_POLYORD: 2

# degree of the polynomial for the 1/f correction
# degree_1f_corr = 0 -> just a constant through the 256 pix spatial
# degree_1f_corr = 1 -> slope ... and so on
DEGREE_1F_CORR: 0

# Trace extraction width. Set to 0 to use the full image
TRACE_WIDTH_EXTRACTION: 40

# used for masking and WLC
TRACE_WIDTH_MASKING: 40

# do remove trend from out-of-transit
REMOVE_TREND: true

# define how the "white" transit depth is computed/assigned
#   "compute": Compute transit depth using median OOT relative flux from WLC,
#       and mean in-transit relative flux from WLC
#   OR
#   "known": provide the number in TDEPTH
TDEPTH_MODE: "compute"
# define the "white" transit depth if known
TDEPTH: None

# Define the resolution to bin to
RESOLUTION_BIN: 20

# define the area around which we will optimize the background
#   this should be a length 4 list (x start, x end, y start, y end)
BACKGROUND_GLITCH_BOX:
- 650
- 750
- 200
- 240